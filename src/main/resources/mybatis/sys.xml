<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.wanke.com.mapper.SysMapper">

<select id="findAllSysResources"  resultType="org.wanke.com.entity.SysResources">
   SELECT * from sys_resources;
</select>

<select id="findSysResourcesByUserId" parameterType="long" resultType="org.wanke.com.entity.SysResources">
      select re.*
		from sys_user u
        LEFT JOIN sys_user_role ru on u.id= ru.user_id
        LEFT JOIN sys_role ro on ru.role_id=ro.id
        LEFT JOIN sys_role_resources rr on rr.role_id=ro.id
        LEFT JOIN sys_resources re on re.id =rr.resources_id
        where u.id=#{userId}
 </select>
 
 	<resultMap id="userMap" type="org.wanke.com.entity.SysUser">
        <id property="id" column="ID"/>
        <result property="account" column="account"/>
        <result property="password" column="PASSWORD"/>
        <collection property="roles" ofType="org.wanke.com.entity.SysRole">
            <result column="role_name" property="role_name"/>
        </collection>

    </resultMap>
    
    <select id="findByUserAccount" parameterType="String" resultMap="userMap">
		select u.*,r.*
		from sys_user u
        LEFT JOIN sys_user_role sru on u.id= sru.user_id
        LEFT JOIN sys_role r on sru.role_id=r.id
        where account= #{account}
	</select>
 
	<insert id="signUp" parameterType="org.wanke.com.entity.SysUser">
        insert into sys_user(
            account,
			password,
			user_name,
			phone,
			sex,
			store_id,
			enable,
			type,
			head_url,
			create_time,
			create_id)
		values (
	        #{account},
	        #{password},
	        #{user_name},
	        #{phone},
			#{sex},
			#{store_id},
			#{enable},
			#{type},
			#{head_url},
			#{create_time},
			#{create_id})
    </insert>
</mapper>